{exec}  = require "child_process"
processes =
  list : []
  run : (options,callback) ->
    {restart,cmd,log}   = options
    cp = exec cmd,callback
    processes.list.push cmd:cmd, process : cp, pid : cp.pid
    if log
      cp.stdout.on 'data', (data) -> 
        console.log "#{data}".replace /\n+$/, '' 
      cp.stderr.on 'data', (data) -> 
        console.log "#{data}".replace /\n+$/, '' 
    cp.on 'exit', () -> 
      console.log cp.pid+" did exit"      
      if restart
        setTimeout (-> processes.run options,callback),restart
        console.log "Restarting the process in #{restart} msecs."

module.exports = processes