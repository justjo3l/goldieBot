var exec, processes;

exec = require("child_process").exec;

processes = {
  list: [],
  run: function(options, callback) {
    var cmd, cp, log, restart;
    restart = options.restart, cmd = options.cmd, log = options.log;
    cp = exec(cmd, callback);
    processes.list.push({
      cmd: cmd,
      process: cp,
      pid: cp.pid
    });
    if (log) {
      cp.stdout.on('data', function(data) {
        return console.log(("" + data).replace(/\n+$/, ''));
      });
      cp.stderr.on('data', function(data) {
        return console.log(("" + data).replace(/\n+$/, ''));
      });
    }
    return cp.on('exit', function() {
      console.log(cp.pid + " did exit");
      if (restart) {
        setTimeout((function() {
          return processes.run(options, callback);
        }), restart);
        return console.log("Restarting the process in " + restart + " msecs.");
      }
    });
  }
};

module.exports = processes;
